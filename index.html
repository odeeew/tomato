<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no"/>
  <title>Tomato</title>
  <style>
    body {padding: 0;margin: 0;background: #ccc;font-family: Arial, "文泉驛正黑", "WenQuanYi Zen Hei", "儷黑 Pro", "LiHei Pro", "微軟正黑體", "Microsoft JhengHei", "標楷體", DFKai-SB, sans-serif;}
    #customAlert {width: 100vw;height: 100vh;position: absolute;top:0;left:0;z-index: 3;}
    #customAlert p {text-align: center;line-height: 100vh;font-size: 30px;margin: 0}
    #bg {width: 100%;height: 100vh;position: relative;z-index: 1;background: url("https://unsplash.it/1920/1080/?random");background-size: cover}
    #counterDisplay {position: absolute;bottom: 0;left: 0;z-index: 2;opacity: 0.3;background: #fff;padding:10px;}
  </style>
</head>
<body>
<div id="customAlert" style="display: none;"></div>
<div id="bg"></div>
<div id="counterDisplay">
  <div id="focusCountdown"></div>
  <div id="relaxCountdown"></div>
</div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {

    //get setting from url
    var u = window.location.href,
        setting = u.split('?', 2)[1],
        focusMin = parseInt(setting.split('&',2)[0]),
        relaxMin = setting.split('&',2)[1],
        focusCountdown = focusMin * 60,//分鐘數轉秒數
        relaxCountdown = relaxMin * 60,
        focusCountdownId,
        relaxCountdownId,
        x,
        y;

    function initialFocusCountdown(){
      x = document.getElementById("focusCountdown");
      x.innerHTML = '專注&nbsp;' + focusMin + ':00';
      focusCountdown --;
      focusCountdownId = window.setInterval(focusCountdownFunc,1000);
    }

    function focusCountdownFunc(){
      var  leftFocusM = Math.floor(focusCountdown / 60),
            leftFocusS = focusCountdown - leftFocusM * 60;
      x.innerHTML = '專注&nbsp;' + leftFocusM + ':' + leftFocusS;
      if (focusCountdown == 3){
        customAlert('#fff','#000','該休息囉～');
        setTimeout(function () {
          clearInterval(focusCountdownId);
          initialRelaxCountdown();
        },3000);
      }
      focusCountdown --;
    }
    initialFocusCountdown();

    function initialRelaxCountdown() {
      y = document.getElementById("relaxCountdown");
      y.innerHTML = '休息&nbsp;' + relaxMin + ':00';
      relaxCountdown --;
      relaxCountdownId = window.setInterval(relaxCountdownFunc,1000);
    }

    function relaxCountdownFunc(){
      var leftRelaxM = Math.floor(relaxCountdown / 60),
              leftRelaxS = relaxCountdown - leftRelaxM * 60;
      y.innerHTML = '休息&nbsp;' + leftRelaxM + ':' + leftRelaxS;
      if (relaxCountdown == 3){
        customAlert('#000','#fff','該工作囉～');
        setTimeout(function () {
          clearInterval(relaxCountdownId);
        },3000);
      }
      relaxCountdown --;
    }

    function customAlert(bgColor,textColor,text) {
      $('#customAlert').css({'background-color':bgColor,'color':textColor}).html('<p>' + text + '</p>');
      if (navigator.vibrate){
        navigator.vibrate(1000);
      }else if (navigator.webkitVibrate){
        navigator.webkitVibrate(1000);
      }
      function flash(){
        $('#customAlert').fadeIn(500).fadeOut(500);
      }
      var flashId = window.setInterval(flash,500);
      setTimeout(function () {
        clearInterval(flashId);
      },3000);
    }
  });
</script>
</body>
</html>